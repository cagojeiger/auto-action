name: Slack Notifications

on:
  workflow_run:
    workflows:
      - "Docker Image Push"
      - "Update Code-Server"
      - "Update File-Fetcher"
      - "Update OpenClaw"
      - "Publish Helm Charts to GitHub Pages"
    types:
      - completed

jobs:
  notify-failure:
    name: Send Slack Notification
    if: github.event.workflow_run.conclusion == 'failure'
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack Message
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          # ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œìš° ì •ë³´
          WORKFLOW_NAME="${{ github.event.workflow_run.name }}"
          WORKFLOW_URL="${{ github.event.workflow_run.html_url }}"
          BRANCH="${{ github.event.workflow_run.head_branch }}"
          ACTOR="${{ github.event.workflow_run.actor.login }}"
          
          # Slack ë©”ì‹œì§€ ì „ì†¡
          curl -X POST -H 'Content-type: application/json' \
          --data "{
            \"text\": \"âŒ GitHub Actions ì‹¤íŒ¨ ì•Œë¦¼\",
            \"blocks\": [
              {
                \"type\": \"section\",
                \"text\": {
                  \"type\": \"mrkdwn\",
                  \"text\": \"*ì›Œí¬í”Œë¡œìš°:* ${WORKFLOW_NAME}\n*ë¸Œëœì¹˜:* ${BRANCH}\n*ì‹¤í–‰ì:* ${ACTOR}\"
                }
              },
              {
                \"type\": \"actions\",
                \"elements\": [
                  {
                    \"type\": \"button\",
                    \"text\": {
                      \"type\": \"plain_text\",
                      \"text\": \"ğŸ” ì‹¤íŒ¨ ë‚´ìš© í™•ì¸\"
                    },
                    \"url\": \"${WORKFLOW_URL}\"
                  }
                ]
              }
            ]
          }" \
          ${SLACK_WEBHOOK_URL}