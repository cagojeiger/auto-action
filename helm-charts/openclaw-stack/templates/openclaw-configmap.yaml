{{- if and .Values.openclaw.enabled (not .Values.openclaw.existingConfigMap) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "openclaw-stack.openclawName" . }}-config
  labels:
    {{- include "openclaw-stack.labels" . | nindent 4 }}
    app.kubernetes.io/component: openclaw
data:
  openclaw.json: |
    {{- $config := deepCopy .Values.openclaw.config }}
    {{- if .Values.browserless.enabled }}
    {{- $cdpUrl := printf "http://%s:%v" (include "openclaw-stack.browserlessName" .) (int .Values.browserless.service.port) }}
    {{- $browser := dict "enabled" true "attachOnly" true "defaultProfile" "browserless" "profiles" (dict "browserless" (dict "cdpUrl" $cdpUrl "color" "#FF4500")) }}
    {{- $_ := set $config "browser" $browser }}
    {{- else }}
    {{- $_ := set $config "browser" (dict "enabled" false) }}
    {{- end }}
    {{ toPrettyJson $config | nindent 4 }}
{{- end }}
