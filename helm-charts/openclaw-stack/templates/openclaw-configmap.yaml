{{- if .Values.openclaw.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "openclaw-stack.openclawName" . }}-config
  labels:
    {{- include "openclaw-stack.labels" . | nindent 4 }}
    app.kubernetes.io/component: openclaw
data:
  openclaw.json: |
    {
      "gateway": {
        "controlUi": {
          "allowInsecureAuth": true
        }
      },
      "agents": {
        "defaults": {
          "model": {
            "primary": "litellm/{{ .Values.openclaw.litellm.model.id }}"
          }
        }
      },
      "tools": {
        "profile": "{{ .Values.openclaw.tools.profile }}"
      },
      "models": {
        "providers": {
          "litellm": {
            "baseUrl": "{{ .Values.openclaw.litellm.baseUrl }}",
            "api": "openai-completions",
            "models": [
              {
                "id": "{{ .Values.openclaw.litellm.model.id }}",
                "name": "{{ .Values.openclaw.litellm.model.name }}",
                "contextWindow": 1048576,
                "maxTokens": 8192,
                "reasoning": false,
                "input": ["text", "image"],
                "cost": { "input": 0, "output": 0, "cacheRead": 0, "cacheWrite": 0 }
              }
            ]
          }
        }
      },
      "browser": {
        "enabled": {{ .Values.browserless.enabled }},
        "attachOnly": true,
        "defaultProfile": "browserless",
        "profiles": {
          "browserless": {
            "cdpUrl": "http://{{ include "openclaw-stack.browserlessName" . }}:{{ .Values.browserless.service.port }}",
            "color": "#FF4500"
          }
        }
      }
      {{- if .Values.openclaw.slack.enabled }},
      "channels": {
        "slack": {
          "dm": {
            "policy": "{{ .Values.openclaw.slack.dm.policy }}"
          },
          "groupPolicy": "{{ .Values.openclaw.slack.groupPolicy }}"
        }
      }
      {{- end }}
    }
{{- end }}
