suite: 프로브(Probes) 기능 테스트
tests:
  - it: 기본 프로브 설정이 올바르게 적용되어야 함
    template: deployment.yaml
    set:
      templateDefaults:
        web:
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /ready
              port: http
            initialDelaySeconds: 5
            periodSeconds: 5
      templates:
        - name: basic-probes
          type: web
          image:
            repository: nginx
            tag: "latest"
          service:
            enabled: true
            port: 80
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.path
          value: /health
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.path
          value: /ready

  - it: 프로브 설정이 올바르게 오버라이드되어야 함
    template: deployment.yaml
    set:
      templateDefaults:
        web:
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /ready
              port: http
            initialDelaySeconds: 5
            periodSeconds: 5
      templates:
        - name: override-probes
          type: web
          image:
            repository: nginx
            tag: "latest"
          service:
            enabled: true
            port: 80
          livenessProbe:
            httpGet:
              path: /custom-health
            initialDelaySeconds: 60
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.path
          value: /custom-health
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.initialDelaySeconds
          value: 60
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.periodSeconds
          value: 10
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.path
          value: /ready

  - it: 중첩 구조 프로브 설정이 올바르게 적용되어야 함
    template: deployment.yaml
    set:
      templateDefaults:
        default:
          livenessProbe:
            enabled: true
            httpGet:
              path: /default-health
              port: http
            initialDelaySeconds: 10
          readinessProbe:
            enabled: true
            httpGet:
              path: /default-ready
              port: http
            initialDelaySeconds: 5
        web:
          livenessProbe:
            httpGet:
              path: /web-health
            initialDelaySeconds: 30
      templates:
        - name: nested-probes
          type: web
          image:
            repository: nginx
            tag: "latest"
          service:
            enabled: true
            port: 80
          livenessProbe:
            httpGet:
              path: /custom-health
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.httpGet.path
          value: /custom-health
      - equal:
          path: spec.template.spec.containers[0].livenessProbe.initialDelaySeconds
          value: 30
      - equal:
          path: spec.template.spec.containers[0].readinessProbe.httpGet.path
          value: /default-ready 