suite: 영구 저장소 기능 테스트
tests:
  - it: 기본 PVC 설정이 올바르게 적용되어야 함
    template: pvc.yaml
    set:
      global:
        storageClass: "premium"
      templateDefaults:
        database:
          persistence:
            enabled: true
            size: 1Gi
            accessMode: ReadWriteOnce
      templates:
        - name: basic-db
          type: database
          image:
            repository: postgres
            tag: "14"
    asserts:
      - isKind:
          of: PersistentVolumeClaim
      - equal:
          path: spec.resources.requests.storage
          value: 1Gi
      - equal:
          path: spec.accessModes[0]
          value: ReadWriteOnce
      - equal:
          path: spec.storageClassName
          value: premium

  - it: 사용자 지정 PVC 이름이 올바르게 적용되어야 함
    template: pvc.yaml
    set:
      global:
        storageClass: "premium"
      templateDefaults:
        database:
          persistence:
            enabled: true
            size: 1Gi
      templates:
        - name: custom-name-db
          type: database
          image:
            repository: mysql
            tag: "8.0"
          persistence:
            name: "my-custom-pvc"
            size: 5Gi
    asserts:
      - isKind:
          of: PersistentVolumeClaim
      - equal:
          path: metadata.name
          value: my-custom-pvc
      - equal:
          path: spec.resources.requests.storage
          value: 5Gi

  - it: 스토리지 클래스 우선순위가 올바르게 적용되어야 함
    template: pvc.yaml
    set:
      global:
        defaultStorageClass: "standard"
        storageClass: "premium"
      templateDefaults:
        database:
          persistence:
            enabled: true
            size: 1Gi
      templates:
        - name: storage-class-priority
          type: database
          image:
            repository: mongodb
            tag: "5.0"
          persistence:
            storageClassName: "local-storage"
    asserts:
      - isKind:
          of: PersistentVolumeClaim
      - equal:
          path: spec.storageClassName
          value: local-storage 